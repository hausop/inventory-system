<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â∫´Â≠òÁÆ°ÁêÜÁ≥ªÁµ± - Modern UI</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FAFAF8;
            z-index: -1;
        }
        
        /* ÊØõÁéªÁíÉÊïàÊûú */
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Ê∑±Â±§Èô∞ÂΩ± */
        .shadow-soft {
            box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.05),
                        0 0 40px 0 rgba(0, 0, 0, 0.02);
        }
        
        .shadow-soft-lg {
            box-shadow: 0 0 30px 0 rgba(0, 0, 0, 0.08),
                        0 0 50px 0 rgba(0, 0, 0, 0.04);
        }
        
        /* Âç°ÁâáÊá∏ÊµÆÊïàÊûú */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
        }
        
        /* ÊªëÂãïÂãïÁï´ */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        /* iOS Toggle ÈñãÈóú */
        .toggle-switch {
            position: relative;
            width: 51px;
            height: 31px;
            background-color: #e5e7eb;
            border-radius: 31px;
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        .toggle-switch.active {
            background-color: #8b5cf6;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 27px;
            height: 27px;
            border-radius: 27px;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-switch.active::after {
            transform: translateX(20px);
        }
        
        /* ÂàÜÊÆµÊéßÂà∂Âô® */
        .segmented-control {
            display: inline-flex;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 2px;
            position: relative;
        }
        
        .segmented-control-item {
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            z-index: 1;
            position: relative;
        }
        
        .segmented-control-item.active {
            color: white;
        }
        
        .segmented-control-indicator {
            position: absolute;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            top: 2px;
            bottom: 2px;
        }
        
        /* FAB ÊåâÈàï */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .fab-menu {
            position: fixed;
            bottom: 88px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }
        
        .fab-menu-item {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }
        
        .fab-menu-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* È™®Êû∂Â±è */
        @keyframes skeleton {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s infinite;
        }
         
        /* ÊêúÁ¥¢Ê°ÜÂãïÁï´ */
        .search-box {
            transition: all 0.3s;
        }
        
        .search-box:focus-within {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        /* ËºâÂÖ•ÂãïÁï´ */
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid #f3f4f6;
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Á©∫ÁãÄÊÖãÊèíÁï´ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }
        
        /* Èò≤Ê≠¢ iOS Ëº∏ÂÖ•Ê°ÜÁ∏ÆÊîæ */
        input, textarea, select {
            font-size: 16px !important;
            -webkit-appearance: none;
            border-radius: 12px;
        }
        
        /* Ëá™ÂÆöÁæ©ÊªæÂãïÊ¢ù */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6b4298 100%);
        }
        
        /* Ê®ôÁ±§Ê®£Âºè */
        .tag-pill {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .tag-pill:hover {
            transform: scale(1.05);
        }
        
        /* Ê®°ÊÖãÊ°ÜËÉåÊôØ */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex items-center justify-center min-h-screen">
            <div class="loader"></div>
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, memo, useMemo } = React;
        
        // üîß Supabase Ë®≠ÂÆö
        const SUPABASE_URL = 'https://sfgvmpsmndyogqrdtoar.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmZ3ZtcHNtbmR5b2dxcmR0b2FyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNTU2OTEsImV4cCI6MjA2OTkzMTY5MX0.uCWRlPtiYqR-_7jWdQd9RzaBk0SHzRn_0dWbWG0M-J0';
        
        // ÂàùÂßãÂåñ Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Áèæ‰ª£ÂåñÂúñÁ§∫ÁµÑ‰ª∂
        const Icons = {
            Package: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
            ),
            Plus: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
            ),
            Grid: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
            ),
            List: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            ),
            Search: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            ),
            Tag: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                </svg>
            ),
            Users: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
            ),
            ChevronLeft: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
            ),
            X: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
            ),
            Edit: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            ),
            Archive: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                </svg>
            ),
            TrendingUp: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
            ),
            TrendingDown: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                </svg>
            )
        };
        
        // ‰∏ªÊáâÁî®Á®ãÂºè
        const InventoryManager = () => {
            const [currentView, setCurrentView] = useState('overview');
            const [selectedItem, setSelectedItem] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [showFabMenu, setShowFabMenu] = useState(false);
            const [viewMode, setViewMode] = useState('grid');
            const [searchQuery, setSearchQuery] = useState('');
            const [filterCategory, setFilterCategory] = useState('ÂÖ®ÈÉ®');
            const [inventory, setInventory] = useState([]);
            const [categories, setCategories] = useState([]);
            const [operators, setOperators] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showAddItemModal, setShowAddItemModal] = useState(false);
            const [showCategoryModal, setShowCategoryModal] = useState(false);
            const [showOperatorModal, setShowOperatorModal] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [adminPassword, setAdminPassword] = useState('admin123');

            const loadAdminPassword = async () => {
                try {
                    const { data, error } = await supabase
                        .from('admin_settings')
                        .select('setting_value')
                        .eq('setting_key', 'admin_password')
                        .single();
                    
                    if (data) {
                        setAdminPassword(data.setting_value);
                    }
                } catch (error) {
                    console.error('ËºâÂÖ•ÂØÜÁ¢ºË®≠ÂÆöÂ§±Êïó:', error);
                }
            };

            const updateAdminPassword = async (newPassword) => {
                try {
                    const { error } = await supabase
                        .from('admin_settings')
                        .update({ 
                            setting_value: newPassword,
                            updated_at: new Date().toISOString()
                        })
                        .eq('setting_key', 'admin_password');
                    
                    if (error) throw error;
                    
                    setAdminPassword(newPassword);
                    alert('ÂØÜÁ¢ºÊõ¥Êñ∞ÊàêÂäüÔºÅ');
                    return true;
                } catch (error) {
                    console.error('Êõ¥Êñ∞ÂØÜÁ¢ºÂ§±Êïó:', error);
                    alert('ÂØÜÁ¢ºÊõ¥Êñ∞Â§±Êïó');
                    return false;
                }
            };
            
            const loadInventory = async () => {
                try {
                    const { data, error } = await supabase
                        .from('inventory')
                        .select('*')
                        .order('id', { ascending: true });
                    
                    if (error) throw error;
                    setInventory(data || []);
                } catch (error) {
                    console.error('ËºâÂÖ•Â∫´Â≠òÂ§±Êïó:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const loadCategories = async () => {
                try {
                    const { data, error } = await supabase
                        .from('categories')
                        .select('*')
                        .order('name', { ascending: true });
                    
                    if (error) throw error;
                    setCategories(data || []);
                } catch (error) {
                    console.error('ËºâÂÖ•È°ûÂà•Â§±Êïó:', error);
                }
            };
            
            const loadOperators = async () => {
                try {
                    const { data, error } = await supabase
                        .from('operators')
                        .select('*')
                        .order('name', { ascending: true });
                    
                    if (error) throw error;
                    setOperators(data || []);
                } catch (error) {
                    console.error('ËºâÂÖ•Êìç‰Ωú‰∫∫Âì°Â§±Êïó:', error);
                }
            };

            const loadItemRecords = async (itemId) => {
                try {
                    const { data, error } = await supabase
                        .from('records')
                        .select('*')
                        .eq('item_id', itemId)
                        .order('operation_date', { ascending: false });
                    
                    if (error) {
                        console.error('ËºâÂÖ•Ë®òÈåÑÂ§±Êïó:', error);
                        return [];
                    }
                    
                    return data || [];
                } catch (error) {
                    console.error('ËºâÂÖ•Ë®òÈåÑÈåØË™§:', error);
                    return [];
                }
            };

            useEffect(() => {
                loadInventory();
                loadCategories();
                loadOperators();
                loadAdminPassword();
            }, []);
            
            const filteredInventory = useMemo(() => {
                return inventory.filter(item => {
                    const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
                    const matchesCategory = filterCategory === 'ÂÖ®ÈÉ®' || item.category === filterCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [inventory, searchQuery, filterCategory]);
            
            // È†ÇÈÉ®Â∞éËà™Ê¨Ñ
            const TopNavBar = () => (
                <div className="fixed top-0 left-0 right-0 glass-morphism shadow-soft z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center">
                                    <Icons.Package size={20} className="text-white" />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-gray-800">Â∫´Â≠òÁÆ°ÁêÜ</h1>
                                    <p className="text-xs text-gray-500">Êô∫ËÉΩÂÄâÂÑ≤Á≥ªÁµ±</p>
                                </div>
                            </div>
                            
                            <div className="hidden md:block flex-1 max-w-md mx-8">
                                <div className="search-box relative">
                                    <Icons.Search size={20} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
                                    <input
                                        type="text"
                                        placeholder="ÊêúÂ∞ãÂïÜÂìÅ..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-all"
                                    />
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <div className="hidden sm:flex items-center bg-gray-100 rounded-lg p-1">
                                    <button
                                        onClick={() => setViewMode('grid')}
                                        className={`p-2 rounded-md transition-all ${viewMode === 'grid' ? 'bg-white shadow-sm' : ''}`}
                                    >
                                        <Icons.Grid size={18} className={viewMode === 'grid' ? 'text-purple-600' : 'text-gray-500'} />
                                    </button>
                                    <button
                                        onClick={() => setViewMode('list')}
                                        className={`p-2 rounded-md transition-all ${viewMode === 'list' ? 'bg-white shadow-sm' : ''}`}
                                    >
                                        <Icons.List size={18} className={viewMode === 'list' ? 'text-purple-600' : 'text-gray-500'} />
                                    </button>
                                </div>
                                
                                <div className="flex items-center gap-2">
                                    <span className="text-sm text-gray-600 hidden sm:inline">ÁÆ°ÁêÜÊ®°Âºè</span>
                                    <button 
                                        className={`toggle-switch ${isAdmin ? 'active' : ''}`}
                                        onClick={(e) => {
                                            e.preventDefault();
                                            e.stopPropagation();
                                            if (isAdmin) {
                                                setIsAdmin(false);
                                            } else {
                                                setShowPasswordModal(true);
                                            }
                                        }}
                                        type="button"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // ‰øÆÂæ©ÂæåÁöÑÂàÜÊÆµÊéßÂà∂Âô®
            const CategoryFilter = () => {
                const allCategories = ['ÂÖ®ÈÉ®', ...categories.map(c => c.name)];
                const [indicatorStyle, setIndicatorStyle] = useState({});
                const itemRefs = useRef({});
                
                useEffect(() => {
                    const activeItem = itemRefs.current[filterCategory];
                    if (activeItem) {
                        setIndicatorStyle({
                            left: activeItem.offsetLeft + 'px',
                            width: activeItem.offsetWidth + 'px'
                        });
                    }
                }, [filterCategory]);
                
                return (
                    <div className="overflow-x-auto pb-2">
                        <div className="segmented-control inline-flex min-w-max">
                            <div className="segmented-control-indicator" style={indicatorStyle} />
                            {allCategories.map(category => (
                                <div
                                    key={category}
                                    ref={el => itemRefs.current[category] = el}
                                    className={`segmented-control-item ${filterCategory === category ? 'active' : ''}`}
                                    onClick={() => setFilterCategory(category)}
                                >
                                    {category}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };
            
            // ÂïÜÂìÅÂç°Áâá
            const ProductCard = ({ item }) => {
                const [imageLoaded, setImageLoaded] = useState(false);

                const getStockStatus = (stock) => {
                    if (stock === 0) return { gradient: 'bg-gradient-to-r from-gray-400 to-gray-500', pulse: false };
                    if (stock < 10) return { gradient: 'bg-gradient-to-r from-red-500 to-red-600', pulse: false };
                    if (stock < 50) return { gradient: 'bg-gradient-to-r from-amber-400 to-orange-500', pulse: false };
                    return { gradient: 'bg-gradient-to-r from-emerald-500 to-green-600', pulse: false };
                };

                const status = getStockStatus(item.stock);

                return (
                    <div 
                        className="card-hover bg-white rounded-2xl shadow-soft overflow-hidden cursor-pointer group w-full sm:max-w-[220px]"
                        onClick={() => navigateToDetail(item)}
                    >
                        <div className="aspect-square bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center relative overflow-hidden">
                            {!imageLoaded && (
                                <div className="absolute inset-0 skeleton" />
                            )}
                            {item.image_url ? (
                                <img 
                                    src={item.image_url} 
                                    alt={item.name}
                                    className={`w-full h-full object-cover transition-transform duration-300 group-hover:scale-110 ${imageLoaded ? '' : 'opacity-0'}`}
                                    onLoad={() => setImageLoaded(true)}
                                />
                            ) : (
                                <div className="w-full h-full flex items-center justify-center">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" className="text-gray-300">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                    </svg>
                                </div>
                            )}
                            
                            <div className="absolute top-3 left-3">
                                <div className="bg-gray-100 text-gray-600 px-3 py-0.5 rounded-full text-xs font-medium">
                                    {item.category || 'Êú™ÂàÜÈ°û'}
                                </div>
                            </div>
                            
                            <div className="absolute bottom-3 right-3">
                                <div className={`px-3 py-1 rounded-full text-white font-bold shadow-lg text-sm ${status.gradient}`}>
                                    {item.stock}
                                </div>
                            </div>
                            
                            {isAdmin && (
                                <div className="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            setEditingItem(item);
                                        }}
                                        className="bg-white p-2 rounded-full shadow-md hover:shadow-lg transition-all"
                                    >
                                        <Icons.Edit size={16} className="text-gray-600" />
                                    </button>
                                </div>
                            )}
                        </div>
                        
                        <div className="p-4">
                            <h3 className="font-semibold text-base text-gray-900 mb-2 truncate">
                                {item.name}
                            </h3>
                            <div className="flex items-center gap-1.5 text-xs text-gray-500">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                <span 
                                    className="truncate max-w-full sm:max-w-[140px]"
                                    title={item.location || 'Êú™Ë®≠ÂÆö‰ΩçÁΩÆ'}
                                >
                                    {item.location ? item.location : 'Êú™Ë®≠ÂÆö‰ΩçÁΩÆ'}
                                </span>
                            </div>
                        </div>
                    </div>
                );
            };

            // ÂàóË°®Ë¶ñÂúñÈ†ÖÁõÆ
            const ProductListItem = ({ item }) => {
                const getStockStatus = (stock) => {
                    if (stock === 0) return { color: 'bg-gray-500', text: 'Áº∫Ë≤®' };
                    if (stock < 10) return { color: 'bg-red-500', text: 'Â∫´Â≠ò‰∏çË∂≥' };
                    if (stock < 50) return { color: 'bg-amber-500', text: 'Â∫´Â≠òÂÅè‰Ωé' };
                    return { color: 'bg-emerald-500', text: 'Â∫´Â≠òÂÖÖË∂≥' };
                };
                
                const status = getStockStatus(item.stock);
                
                return (
                    <div 
                        className="bg-white rounded-xl shadow-soft p-4 mb-3 hover:shadow-soft-lg transition-all cursor-pointer"
                        onClick={() => navigateToDetail(item)}
                    >
                        <div className="flex items-center gap-4">
                            <div className="w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0">
                                {item.image_url ? (
                                    <img src={item.image_url} alt={item.name} className="w-full h-full object-cover" />
                                ) : (
                                    <div className="w-full h-full flex items-center justify-center">
                                        <Icons.Package size={24} className="text-gray-400" />
                                    </div>
                                )}
                            </div>
                            
                            <div className="flex-1">
                                <h3 className="font-semibold text-gray-800">{item.name}</h3>
                                <div className="flex items-center gap-3 mt-1">
                                    <span className="text-sm text-gray-500">{item.category || 'Êú™ÂàÜÈ°û'}</span>
                                    <span className="text-sm text-gray-400">‚Ä¢</span>
                                    <span className="text-sm text-gray-500">üìç {item.location || 'Êú™Ë®≠ÂÆö'}</span>
                                </div>
                            </div>
                            
                            <div className="text-right">
                                <div className="text-2xl font-bold text-gray-800">{item.stock}</div>
                                <div className={`text-xs ${status.color} bg-opacity-10 px-2 py-1 rounded-full inline-block`}>
                                    <span className={`${status.color.replace('bg-', 'text-')}`}>{status.text}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };
            
            // Á©∫ÁãÄÊÖã
            const EmptyState = () => (
                <div className="empty-state">
                    <div className="w-32 h-32 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                        <Icons.Package size={64} className="text-purple-400" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-800 mb-2">Â∞öÁÑ°ÂïÜÂìÅË≥áÊñô</h3>
                    <p className="text-gray-500 mb-6">ÈñãÂßãÊñ∞Â¢ûÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄãÂïÜÂìÅÂêßÔºÅ</p>
                    {isAdmin && (
                        <button
                            onClick={() => setShowAddItemModal(true)}
                            className="px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                        >
                            Êñ∞Â¢ûÂïÜÂìÅ
                        </button>
                    )}
                </div>
            );
            
            // FAB ÊµÆÂãïÊåâÈàï
            const FAB = () => (
                <>
                    {showFabMenu && isAdmin && (
                        <div className="fab-menu slide-up">
                            <div className="fab-menu-item" onClick={() => {
                                setShowOperatorModal(true);
                                setShowFabMenu(false);
                            }}>
                                <Icons.Users size={20} className="text-purple-600" />
                            </div>
                            <div className="fab-menu-item" onClick={() => {
                                setShowCategoryModal(true);
                                setShowFabMenu(false);
                            }}>
                                <Icons.Tag size={20} className="text-purple-600" />
                            </div>
                            <div className="fab-menu-item" onClick={() => {
                                setShowAddItemModal(true);
                                setShowFabMenu(false);
                            }}>
                                <Icons.Package size={20} className="text-purple-600" />
                            </div>
                        </div>
                    )}
                    
                    {isAdmin && (
                        <div 
                            className="fab"
                            onClick={() => setShowFabMenu(!showFabMenu)}
                        >
                            <Icons.Plus 
                                size={24} 
                                className={`transition-transform duration-300 ${showFabMenu ? 'rotate-45' : ''}`}
                            />
                        </div>
                    )}
                </>
            );
                      
            // Â∞éËà™ÂáΩÊï∏
            const navigateToDetail = async (item) => {
                setLoading(true);
                const records = await loadItemRecords(item.id);
                const itemWithRecords = { ...item, records };
                setSelectedItem(itemWithRecords);
                setCurrentView('detail');
                setLoading(false);
                window.history.pushState({ view: 'detail', itemId: item.id }, '', `#item-${item.id}`);
            };
            
            const navigateToOverview = () => {
                setCurrentView('overview');
                setSelectedItem(null);
                window.history.pushState({ view: 'overview' }, '', '#');
            };
            
            // Á∏ΩË¶ΩÈ†ÅÈù¢
            const OverviewPage = () => (
                <div className="min-h-screen pt-20 pb-8">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-white rounded-xl p-4 shadow-soft">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Á∏ΩÂïÜÂìÅ</p>
                                        <p className="text-2xl font-bold text-gray-800">{inventory.length}</p>
                                    </div>
                                    <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <Icons.Package size={20} className="text-purple-600" />
                                    </div>
                                </div>
                            </div>
                                <div className="bg-white rounded-xl p-4 shadow-soft">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">‰ΩéÂ∫´Â≠ò</p>
                                        <p className="text-2xl font-bold text-amber-600">
                                            {inventory.filter(item => item.stock < 10).length}
                                        </p>
                                    </div>
                                    <div className="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                                        <Icons.TrendingDown size={20} className="text-amber-600" />
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white rounded-xl p-4 shadow-soft">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Áº∫Ë≤®</p>
                                        <p className="text-2xl font-bold text-red-600">
                                            {inventory.filter(item => item.stock === 0).length}
                                        </p>
                                    </div>
                                    <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                        <Icons.X size={20} className="text-red-600" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="mb-6">
                            <CategoryFilter />
                        </div>
                        
                        {filteredInventory.length > 0 ? (
                            viewMode === 'grid' ? (
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                                    {filteredInventory.map(item => (
                                        <ProductCard key={item.id} item={item} />
                                    ))}
                                </div>
                            ) : (
                                <div>
                                    {filteredInventory.map(item => (
                                        <ProductListItem key={item.id} item={item} />
                                    ))}
                                </div>
                            )
                        ) : (
                            <EmptyState />
                        )}
                    </div>
                </div>
            );
            
            // Ë©≥Á¥∞È†ÅÈù¢
            const DetailPage = () => {
                const [recordForm, setRecordForm] = useState({
                    type: 'out',
                    quantity: '',
                    note: '',
                    operator: ''
                });
                const [records, setRecords] = useState(selectedItem?.records || []);
                const [showNoteModal, setShowNoteModal] = useState(false);
                const [selectedNote, setSelectedNote] = useState('');

                useEffect(() => {
                    if (!selectedItem) return;
                    
                    const recordsChannel = supabase
                        .channel(`records-${selectedItem.id}`)
                        .on('postgres_changes', 
                            { 
                                event: '*', 
                                schema: 'public', 
                                table: 'records',
                                filter: `item_id=eq.${selectedItem.id}`
                            },
                            async (payload) => {
                                console.log('Ë®òÈåÑËÆäÂåñ:', payload);
                                
                                const updatedRecords = await loadItemRecords(selectedItem.id);
                                setRecords(updatedRecords);
                                
                                const { data: itemData } = await supabase
                                    .from('inventory')
                                    .select('*')
                                    .eq('id', selectedItem.id)
                                    .single();
                                
                                if (itemData) {
                                    setSelectedItem(prev => ({ 
                                        ...prev, 
                                        ...itemData,
                                        records: updatedRecords 
                                    }));
                                }
                            }
                        )
                        .subscribe();
                    
                    return () => {
                        recordsChannel.unsubscribe();
                    };
                }, [selectedItem?.id]);

                if (!selectedItem) return null;

                // ÂÇôË®ªÊ®°ÊÖãÊ°Ü
const NoteModal = () => {
    if (!showNoteModal) return null;
    
    return (
        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-md slide-up">
                <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold text-gray-800">ÂÇôË®ªÂÖßÂÆπ</h3>
                    <button onClick={() => setShowNoteModal(false)}>
                        <Icons.X size={20} className="text-gray-500" />
                    </button>
                </div>
                <div className="bg-gray-50 rounded-lg p-4 max-h-60 overflow-y-auto">
                    <p className="text-gray-700 whitespace-pre-wrap">{selectedNote}</p>
                </div>
                <button
                    onClick={() => setShowNoteModal(false)}
                    className="w-full mt-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all"
                >
                    ÈóúÈñâ
                </button>
            </div>
        </div>
    );
};
                
                const handleSubmitRecord = async () => {
                    if (!recordForm.quantity || !recordForm.operator) {
                        alert('Ë´ãÂ°´ÂØ´ÂÆåÊï¥Ë≥áË®ä');
                        return;
                    }
                    
                    try {
                        const { error: recordError } = await supabase
                            .from('records')
                            .insert({
                                item_id: selectedItem.id,
                                type: recordForm.type,
                                quantity: parseInt(recordForm.quantity),
                                operator: recordForm.operator,
                                note: recordForm.note || '',
                                operation_date: new Date().toISOString()
                            });

                        if (recordError) throw recordError;

                        const newStock = recordForm.type === 'in' 
                            ? selectedItem.stock + parseInt(recordForm.quantity)
                            : Math.max(0, selectedItem.stock - parseInt(recordForm.quantity));

                        await supabase
                            .from('inventory')
                            .update({ stock: newStock })
                            .eq('id', selectedItem.id);

                        const updatedRecords = await loadItemRecords(selectedItem.id);
                        setRecords(updatedRecords);
                        setSelectedItem(prev => ({ ...prev, stock: newStock, records: updatedRecords }));
                        
                        setRecordForm({ type: 'out', quantity: '', note: '', operator: '' });
                        alert('Ë®òÈåÑÊñ∞Â¢ûÊàêÂäüÔºÅ');
                    } catch (error) {
                        console.error('Êñ∞Â¢ûË®òÈåÑÂ§±Êïó:', error);
                        alert('Êìç‰ΩúÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    }
                };
                
                return (
                    <div className="min-h-screen pt-20 pb-8">
                        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                            <button
                                onClick={navigateToOverview}
                                className="flex items-center gap-2 text-purple-600 hover:text-purple-700 mb-6"
                            >
                                <Icons.ChevronLeft size={20} />
                                <span>ËøîÂõûÁ∏ΩË¶Ω</span>
                            </button>
                            
                            <div className="bg-white rounded-2xl shadow-soft p-6 mb-6">
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <div className="aspect-square bg-gray-100 rounded-xl overflow-hidden">
                                            {selectedItem.image_url ? (
                                                <img 
                                                    src={selectedItem.image_url} 
                                                    alt={selectedItem.name}
                                                    className="w-full h-full object-cover"
                                                />
                                            ) : (
                                                <div className="w-full h-full flex items-center justify-center">
                                                    <Icons.Package size={80} className="text-gray-300" />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800 mb-4">{selectedItem.name}</h1>
                                        
                                        <div className="space-y-4">
                                            <div className="flex items-center gap-4">
                                                <span className="text-gray-500">Â∫´Â≠òÊï∏Èáè</span>
                                                <span className="text-3xl font-bold text-purple-600">{selectedItem.stock}</span>
                                            </div>
                                            
                                            <div>
                                                <span className="text-gray-500">È°ûÂà•</span>
                                                <p className="mt-1">
                                                    <span className="tag-pill bg-purple-100 text-purple-700">
                                                        {selectedItem.category || 'Êú™ÂàÜÈ°û'}
                                                    </span>
                                                </p>
                                            </div>
                                            
                                            <div>
                                                <span className="text-gray-500">Â≠òÊîæ‰ΩçÁΩÆ</span>
                                                <p className="mt-1 text-gray-800">{selectedItem.location || 'Êú™Ë®≠ÂÆö'}</p>
                                            </div>
                                            
                                            <div>
                                                <span className="text-gray-500">Ë¶èÊ†º</span>
                                                <p className="mt-1 text-gray-800">{selectedItem.specifications || 'Êú™Ë®≠ÂÆö'}</p>
                                            </div>
                                            
                                            <div>
                                                <span className="text-gray-500">ÂñÆÂÉπ</span>
                                                <p className="mt-1 text-gray-800">NT$ {selectedItem.unit_price || 'Êú™Ë®≠ÂÆö'}</p>
                                            </div>
                                        </div>
                                        
                                        {isAdmin && (
                                            <div className="flex gap-3 mt-6">
                                                <button
                                                    onClick={() => setEditingItem(selectedItem)}
                                                    className="flex-1 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors"
                                                >
                                                    Á∑®ËºØÂïÜÂìÅ
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-2xl shadow-soft p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Icons.Plus size={20} />
                                    Êñ∞Â¢ûÂá∫ÂÖ•Â∫´Ë®òÈåÑ
                                </h2>
                                <div className="space-y-4">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Êìç‰ΩúÈ°ûÂûã</label>
                                            <select
                                                value={recordForm.type}
                                                onChange={(e) => setRecordForm({...recordForm, type: e.target.value})}
                                                className="w-full border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            >
                                                <option value="out">Âá∫Â∫´</option>
                                                <option value="in">ÂÖ•Â∫´</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Êï∏Èáè</label>
                                            <input
                                                type="number"
                                                value={recordForm.quantity}
                                                onChange={(e) => setRecordForm({...recordForm, quantity: e.target.value})}
                                                className="w-full border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Ë´ãËº∏ÂÖ•Êï∏Èáè"
                                                min="1"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Êìç‰Ωú‰∫∫Âì°</label>
                                        <select
                                            value={recordForm.operator}
                                            onChange={(e) => setRecordForm({...recordForm, operator: e.target.value})}
                                            className="w-full border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        >
                                            <option value="">Ë´ãÈÅ∏ÊìáÊìç‰Ωú‰∫∫Âì°</option>
                                            {operators.map(op => (
                                                <option key={op.id} value={op.name}>{op.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ÂÇôË®ª</label>
                                        <textarea
                                            value={recordForm.note}
                                            onChange={(e) => setRecordForm({...recordForm, note: e.target.value})}
                                            className="w-full border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            placeholder="Ë´ãËº∏ÂÖ•ÂÇôË®ªÔºàÈÅ∏Â°´Ôºâ"
                                            rows="3"
                                        />
                                    </div>
                                    <button
                                        onClick={handleSubmitRecord}
                                        className="px-6 py-2 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                                    >
                                        Êèê‰∫§Ë®òÈåÑ
                                    </button>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-2xl shadow-soft p-6">
                                <h2 className="text-xl font-semibold mb-4">Âá∫ÂÖ•Â∫´Ê≠∑Âè≤Ë®òÈåÑ</h2>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b">
                                                <th className="text-left py-2 w-24 sm:w-auto">Êó•Êúü</th>
                                                <th className="text-center py-2 w-16 sm:w-auto">È°ûÂûã</th>
                                                <th className="text-center py-2 w-16 sm:w-auto">Êï∏Èáè</th>
                                                <th className="text-center py-2 w-20 sm:w-auto">Êìç‰Ωú‰∫∫Âì°</th>
                                                <th className="text-left py-2">ÂÇôË®ª</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {records && records.length > 0 ? (
                                                records.map((record, index) => (
                                                    <tr key={record.id || index} className="border-b hover:bg-gray-50">
                                                        <td className="py-2 w-24 sm:w-auto">
                                                            <span className="sm:hidden">
                                                                {new Date(record.operation_date).toLocaleDateString('zh-TW')}
                                                            </span>
                                                            <span className="hidden sm:inline">
                                                                {new Date(record.operation_date).toLocaleString('zh-TW')}
                                                            </span>
                                                        </td>
                                                        <td className="py-2 text-center">
                                                            <span className={`px-2 py-1 rounded text-xs ${
                                                                record.type === 'in' 
                                                                    ? 'bg-green-100 text-green-800' 
                                                                    : 'bg-red-100 text-red-800'
                                                            }`}>
                                                                {record.type === 'in' ? 'ÂÖ•Â∫´' : 'Âá∫Â∫´'}
                                                            </span>
                                                        </td>
                                                        <td className="py-2 text-center">{record.quantity}</td>
                                                        <td className="py-2 text-center">{record.operator}</td>
                                                        <td className="py-2">
    {record.note ? (
        <button
            onClick={() => {
                setSelectedNote(record.note);
                setShowNoteModal(true);
            }}
            className="flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200 transition-colors"
            title="Êü•ÁúãÂÇôË®ª"
        >
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path strokeLinecap="round" strokeLinejoin="round" d="M7 8h10m0 0V6a2 2 0 00-2-2H9a2 2 0 00-2 2v2m10 0v10a2 2 0 01-2 2H9a2 2 0 01-2-2V8m10 0H7m5 5h.01" />
            </svg>
        </button>
    ) : (
        '-'
    )}
</td>
                                                    </tr>
                                                ))
                                            ) : (
                                                <tr>
                                                    <td colSpan="5" className="py-8 text-center text-gray-500">
                                                        Êö´ÁÑ°Âá∫ÂÖ•Â∫´Ë®òÈåÑ
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <NoteModal />
                    </div>
                );
            };
            
   // Á∑®ËºØÂïÜÂìÅÊ®°ÊÖãÊ°Ü
            const EditItemModal = () => {
                const [editForm, setEditForm] = useState({
                    name: editingItem?.name || '',
                    location: editingItem?.location || '',
                    category: editingItem?.category || '',
                    specifications: editingItem?.specifications || '',
                    unit_price: editingItem?.unit_price || ''
                });
                
                const handleSave = async () => {
                    try {
                        const { error } = await supabase
                            .from('inventory')
                            .update({
                                name: editForm.name,
                                location: editForm.location,
                                category: editForm.category,
                                specifications: editForm.specifications,
                                unit_price: editForm.unit_price ? parseInt(editForm.unit_price) : null
                            })
                            .eq('id', editingItem.id);
                        
                        if (error) throw error;
                        
                        await loadInventory();
                        if (selectedItem && selectedItem.id === editingItem.id) {
                            setSelectedItem(prev => ({ ...prev, ...editForm }));
                        }
                        setEditingItem(null);
                        alert('Êõ¥Êñ∞ÊàêÂäüÔºÅ');
                    } catch (error) {
                        console.error('Êõ¥Êñ∞Â§±Êïó:', error);
                        alert('Êõ¥Êñ∞Â§±Êïó');
                    }
                };
                
                if (!editingItem) return null;
                
                return (
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto slide-up">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-gray-800">Á∑®ËºØÂïÜÂìÅ</h2>
                                <button onClick={() => setEditingItem(null)}>
                                    <Icons.X size={24} className="text-gray-500" />
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ÂïÜÂìÅÂêçÁ®±</label>
                                    <input
                                        type="text"
                                        value={editForm.name}
                                        onChange={(e) => setEditForm({...editForm, name: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">È°ûÂà•</label>
                                    <select
                                        value={editForm.category}
                                        onChange={(e) => setEditForm({...editForm, category: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                    >
                                        <option value="">Ë´ãÈÅ∏ÊìáÈ°ûÂà•</option>
                                        {categories.map(category => (
                                            <option key={category.id} value={category.name}>{category.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Â≠òÊîæ‰ΩçÁΩÆ</label>
                                    <textarea
                                        value={editForm.location}
                                        onChange={(e) => setEditForm({...editForm, location: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        rows="3"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Ë¶èÊ†º</label>
                                    <input
                                        type="text"
                                        value={editForm.specifications}
                                        onChange={(e) => setEditForm({...editForm, specifications: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ÂñÆÂÉπ</label>
                                    <input
                                        type="number"
                                        value={editForm.unit_price}
                                        onChange={(e) => setEditForm({...editForm, unit_price: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                    />
                                </div>
                            </div>
                            
                            <div className="flex gap-3 mt-6">
                                <button
                                    onClick={handleSave}
                                    className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                                >
                                    ‰øùÂ≠ò
                                </button>
                                <button
                                    onClick={() => setEditingItem(null)}
                                    className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all"
                                >
                                    ÂèñÊ∂à
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Êñ∞Â¢ûÂïÜÂìÅÊ®°ÊÖãÊ°Ü
            const AddItemModal = () => {
                const [itemForm, setItemForm] = useState({
                    name: '',
                    category: '',
                    location: '',
                    specifications: '',
                    unit_price: '',
                    stock: '0'
                });
                
                const handleAdd = async () => {
                    if (!itemForm.name.trim()) {
                        alert('Ë´ãÂ°´ÂØ´ÂïÜÂìÅÂêçÁ®±');
                        return;
                    }
                    
                    try {
                        const { data, error } = await supabase
                            .from('inventory')
                            .insert({
                                name: itemForm.name,
                                stock: parseInt(itemForm.stock) || 0,
                                location: itemForm.location,
                                category: itemForm.category,
                                specifications: itemForm.specifications,
                                unit_price: parseInt(itemForm.unit_price) || null
                            })
                            .select()
                            .single();
                        
                        if (error) throw error;
                        
                        if (itemForm.stock > 0) {
                            await supabase
                                .from('records')
                                .insert({
                                    item_id: data.id,
                                    type: 'in',
                                    quantity: parseInt(itemForm.stock),
                                    operator: 'Á≥ªÁµ±',
                                    note: 'ÂïÜÂìÅÂàùÂßãÂ∫´Â≠ò',
                                    operation_date: new Date().toISOString()
                                });
                        }
                        
                        await loadInventory();
                        setShowAddItemModal(false);
                        setItemForm({
                            name: '',
                            category: '',
                            location: '',
                            specifications: '',
                            unit_price: '',
                            stock: '0'
                        });
                        alert('ÂïÜÂìÅÊñ∞Â¢ûÊàêÂäüÔºÅ');
                    } catch (error) {
                        console.error('Êñ∞Â¢ûÂ§±Êïó:', error);
                        alert('Êñ∞Â¢ûÂ§±Êïó');
                    }
                };
                
                if (!showAddItemModal) return null;
                
                return (
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto slide-up">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-gray-800">Êñ∞Â¢ûÂïÜÂìÅ</h2>
                                <button onClick={() => setShowAddItemModal(false)}>
                                    <Icons.X size={24} className="text-gray-500" />
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ÂïÜÂìÅÂêçÁ®± *</label>
                                    <input
                                        type="text"
                                        value={itemForm.name}
                                        onChange={(e) => setItemForm({...itemForm, name: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        placeholder="Ë´ãËº∏ÂÖ•ÂïÜÂìÅÂêçÁ®±"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">È°ûÂà•</label>
                                    <select
                                        value={itemForm.category}
                                        onChange={(e) => setItemForm({...itemForm, category: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                    >
                                        <option value="">Ë´ãÈÅ∏ÊìáÈ°ûÂà•</option>
                                        {categories.map(category => (
                                            <option key={category.id} value={category.name}>{category.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Â≠òÊîæ‰ΩçÁΩÆ</label>
                                    <textarea
                                        value={itemForm.location}
                                        onChange={(e) => setItemForm({...itemForm, location: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        placeholder="Ë´ãËº∏ÂÖ•Â≠òÊîæ‰ΩçÁΩÆ"
                                        rows="3"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ÂàùÂßãÂ∫´Â≠ò</label>
                                    <input
                                        type="number"
                                        value={itemForm.stock}
                                        onChange={(e) => setItemForm({...itemForm, stock: e.target.value})}
                                        className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        min="0"
                                    />
                                </div>
                            </div>
                            
                            <div className="flex gap-3 mt-6">
                                <button
                                    onClick={handleAdd}
                                    className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                                >
                                    Êñ∞Â¢û
                                </button>
                                <button
                                    onClick={() => setShowAddItemModal(false)}
                                    className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all"
                                >
                                    ÂèñÊ∂à
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // È°ûÂà•ÁÆ°ÁêÜÊ®°ÊÖãÊ°Ü
            const CategoryModal = () => {
                const [newCategory, setNewCategory] = useState('');
                
                const addCategory = async () => {
                    if (newCategory.trim()) {
                        try {
                            await supabase.from('categories').insert({ name: newCategory.trim() });
                            await loadCategories();
                            setNewCategory('');
                        } catch (error) {
                            console.error('Êñ∞Â¢ûÈ°ûÂà•Â§±Êïó:', error);
                        }
                    }
                };
                
                if (!showCategoryModal) return null;
                
                return (
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-md slide-up">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-gray-800">ÁÆ°ÁêÜÈ°ûÂà•</h2>
                                <button onClick={() => setShowCategoryModal(false)}>
                                    <Icons.X size={24} className="text-gray-500" />
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={newCategory}
                                        onChange={(e) => setNewCategory(e.target.value)}
                                        className="flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        placeholder="Êñ∞Â¢ûÈ°ûÂà•"
                                    />
                                    <button
                                        onClick={addCategory}
                                        className="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700"
                                    >
                                        Êñ∞Â¢û
                                    </button>
                                </div>
                                
                                <div className="max-h-60 overflow-y-auto">
                                    {categories.map(category => (
                                        <div key={category.id} className="flex justify-between items-center py-2 px-2 hover:bg-gray-50 rounded">
                                            <span>{category.name}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <button
                                onClick={() => setShowCategoryModal(false)}
                                className="w-full mt-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200"
                            >
                                ÂÆåÊàê
                            </button>
                        </div>
                    </div>
                );
            };

            // Êìç‰Ωú‰∫∫Âì°ÁÆ°ÁêÜÊ®°ÊÖãÊ°Ü
            const OperatorModal = () => {
                const [newOperator, setNewOperator] = useState('');
                
                const addOperator = async () => {
                    if (newOperator.trim()) {
                        try {
                            await supabase.from('operators').insert({ name: newOperator.trim() });
                            await loadOperators();
                            setNewOperator('');
                        } catch (error) {
                            console.error('Êñ∞Â¢ûÊìç‰Ωú‰∫∫Âì°Â§±Êïó:', error);
                        }
                    }
                };
                
                if (!showOperatorModal) return null;
                
                return (
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-md slide-up">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-gray-800">ÁÆ°ÁêÜÊìç‰Ωú‰∫∫Âì°</h2>
                                <button onClick={() => setShowOperatorModal(false)}>
                                    <Icons.X size={24} className="text-gray-500" />
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={newOperator}
                                        onChange={(e) => setNewOperator(e.target.value)}
                                        className="flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                                        placeholder="Êñ∞Â¢ûÊìç‰Ωú‰∫∫Âì°"
                                    />
                                    <button
                                        onClick={addOperator}
                                        className="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700"
                                    >
                                        Êñ∞Â¢û
                                    </button>
                                </div>
                                
                                <div className="max-h-60 overflow-y-auto">
                                    {operators.map(operator => (
                                        <div key={operator.id} className="flex justify-between items-center py-2 px-2 hover:bg-gray-50 rounded">
                                            <span>{operator.name}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <button
                                onClick={() => setShowOperatorModal(false)}
                                className="w-full mt-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200"
                            >
                                ÂÆåÊàê
                            </button>
                        </div>
                    </div>
                );
            };
                
            // ÂØÜÁ¢ºÊ®°ÊÖãÊ°Ü
            const PasswordModal = () => {
                const [password, setPassword] = useState('');
                const [showChangePassword, setShowChangePassword] = useState(false);
                const [newPassword, setNewPassword] = useState('');
                const [confirmPassword, setConfirmPassword] = useState('');
        
                const handleLogin = () => {
                    if (password === adminPassword) {
                        setIsAdmin(true);
                        setShowPasswordModal(false);
                        setPassword('');
                     } else {
                        alert('ÂØÜÁ¢ºÈåØË™§ÔºÅ');
                     }
                };
        
                const handleChangePassword = async () => {
                    if (newPassword !== confirmPassword) {
                        alert('ÂÖ©Ê¨°Ëº∏ÂÖ•ÁöÑÂØÜÁ¢º‰∏ç‰∏ÄËá¥ÔºÅ');
                        return;
                    }
                    if (newPassword.length < 6) {
                        alert('ÂØÜÁ¢ºÈï∑Â∫¶Ëá≥Â∞ëÈúÄË¶Å6ÂÄãÂ≠óÂÖÉÔºÅ');
                        return;
                    }
                    
                    const success = await updateAdminPassword(newPassword);
                    if (success) {
                        setShowChangePassword(false);
                        setNewPassword('');
                        setConfirmPassword('');
                    }
                };
                
                if (!showPasswordModal) return null;
                
                return (
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-2xl shadow-soft-lg p-6 w-full max-w-sm slide-up">
                            {!showChangePassword ? (
                                <>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">ÁÆ°ÁêÜÂì°ÁôªÂÖ•</h2>
                                    <input
                                        type="password"
                                        placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                        className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 mb-4"
                                        autoFocus
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={handleLogin}
                                            className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                                        >
                                            ÁôªÂÖ•
                                        </button>
                                        <button
                                            onClick={() => setShowPasswordModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all"
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                    </div>
                                    {isAdmin && (
                                        <button
                                            onClick={() => setShowChangePassword(true)}
                                            className="w-full mt-3 text-sm text-purple-600 hover:text-purple-700"
                                        >
                                            ËÆäÊõ¥ÂØÜÁ¢º
                                        </button>
                                    )}
                                </>
                            ) : (
                                <>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">ËÆäÊõ¥ÂØÜÁ¢º</h2>
                                    <input
                                        type="password"
                                        placeholder="Êñ∞ÂØÜÁ¢º"
                                        value={newPassword}
                                        onChange={(e) => setNewPassword(e.target.value)}
                                        className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 mb-3"
                                    />
                                    <input
                                        type="password"
                                        placeholder="Á¢∫Ë™çÊñ∞ÂØÜÁ¢º"
                                        value={confirmPassword}
                                        onChange={(e) => setConfirmPassword(e.target.value)}
                                        className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 mb-4"
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={handleChangePassword}
                                            className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:shadow-lg transition-all"
                                        >
                                            Á¢∫Ë™çËÆäÊõ¥
                                        </button>
                                        <button
                                            onClick={() => setShowChangePassword(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all"
                                        >
                                            ËøîÂõû
                                        </button>
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                );
            };
                
            // ËºâÂÖ•Áï´Èù¢
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="loader mb-4"></div>
                            <p className="text-gray-600">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <>
                    <TopNavBar />
                    {currentView === 'overview' && <OverviewPage />}
                    {currentView === 'detail' && <DetailPage />}
                    <FAB />
                    <PasswordModal />
                    <EditItemModal />
                    <AddItemModal />
                    <CategoryModal />
                    <OperatorModal />
                </>
            );
        };
        
        // Ê∏≤ÊüìÊáâÁî®
        ReactDOM.render(<InventoryManager />, document.getElementById('root'));
    </script>
</body>
</html>
